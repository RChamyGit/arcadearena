<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Abel' rel='stylesheet' type='text/css'>
    <script src="https://kit.fontawesome.com/4dbf725c93.js" crossorigin="anonymous"></script>
    <style>

    body{
       background:rgba(14,16,31,1);
     display:flex;
      flex-direction:column;
      justify-content:center;
    height:100vh;
    font-family: "Abel", sans-serif;}

.flex{
display:flex;
    justify-content:center;
    align-content:middle;
}


#labelInput{
background:none;
color:rgba(255,255,255,.5);
font-size:12px;
border:0;
margin:0 auto;
}

.selEquipe{
margin-top:30px;
}

ul {
    list-style-type: none;
    margin-block-start: 0em;
    margin-block-end: 0em;
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    padding-inline-start: 0px;

}
li{
background:rgba(255,255,255,0.05);
color:rgba(255,255,255,0.7);

height:auto;
padding:4px;
opacity:0.15;
min-width:130px;
margin:5px;
 flex: 1 0 20%;
 border-radius:10px;

}



.noOpacity:hover{
background:#ee4540;
color:rgba(0,0,0,.78);

}

.cursor{
cursor:pointer;
}

.noOpacity{
opacity:0.7;}







#equipesNumber{
color:rgba(255,255,255,.6);
width:auto;
margin-top:5px;
background:rgba(0,0,0,.4);
border:0;
font-size:30px;
padding-left:34px;


}






.box{
width: 80%;
height:auto;
overflow:hidden;
position:relative;
display:block;
background:#282B3D;
padding:15px;
min-width:550px;
}


.top{
width:100%;
 display:flex;
    flex-direction:column;
    justify-content:center;
padding:30px;
height:100%;


}

.borderMaya{
border-right:2px solid rgba(255,255,255,.12);

}
.titleTop{
text-transform: uppercase;
border-bottom:2px solid rgba(255,255,255,.12);
padding-bottom:20px;
}

.titleTop i{
color:rgba(255,255,255,.5);
opacity:0.8;
font-size:39px;
}

.titleTop p{
color:rgba(255,255,255,.5);
opacity:0.8;
font-size:14px;
}

.titleTop h1{
color:rgba(255,255,255,.7);
font-size:50px;
}


.titleTop h6{
color:#ee4540;
opacity:0.8;
font-size:18px;
}




#squadUl{
flex-wrap: wrap;
  display: flex;

    }





.detailsBacket{
background:rgba(0,0,0,.3);
padding:40px;
height:500px;
overflow:auto;
}




.squadItem{
font-size:20px;
height:50px;
display:flex; flex-direction:column; justify-content:center;

}


button:active {
    outline: 0;
    border: 0;
}


select:active {
    outline: 0;
    border: 0;
}
button:focus {outline:0;}
input:focus {outline:0;}

select:focus {
    outline: none;
}

.active{
background:#ee4540;
color:rgba(255,255,255,0.8);
opacity:.7;
}




.subButton{
position:fixed;
top:50%;;
z-index:999999999;
border:3px solid rgba(255,255,255,.45);
padding:3px;
display:flex; flex-direction:column; justify-content:center;
background:rgba(0,0,0,.4);
height:80px;
width:80px;
opacity:0.7;
right:50px;
border-radius:50%;
}

.subButton2{
margin-top:15px;
width:100%;
 display:flex;
      flex-direction:column;
      justify-content:center;
    background: rgba(0,0,0,.3);
border:0;
height:80px;
font-size:25px;
COLOR:RGBA(255,255,255,.6);
}

.subButtonBox h6{
padding:2px;
color:rgba(255,255,255,0.9);
font-weight:500;
font-size:20px;

}

.subButtonBox i{
font-size:35px;
padding:4px;
color:#FAC64B;
position:absolute;
margin-top:30px;

}


.submitOK{
background: #BD0802;
color:#fff;
opacity:1;}


.counterBox{
width:100%;
height:30px;
background: #01BD43;

}





.custom-select:focus {
  outline:none;
    border:none;
    box-shadow:none;
}




.modal-content{
background:#f9d276;

}

.centerT{
display:flex;
      flex-direction:column;
      justify-content:center;}

.modal-body{
padding:60px;
}

.loadBox{
padding:25px;
font-size:20px;
}

.loadBox h6{
margin-top:10px;
}



    </style>
    <title>ARCADE ARENA</title>
</head>

<body>

 <div class="subButton">
                <div class="flex text-center subButtonBox">
                    <h6 id="countSquads">00</h6>
                    <h6>/</h6>
                    <h6 id="totalSquads">00</h6>
                    <i class="fas fa-skull"></i>


                </div>
            </div>
<!--<div class="container-fluid page_title text-center">-->
<!--    <h1>ARCADE ARENA</h1>-->
<!--    <p>dashboard</p>-->
<!--</div>-->
<div class="container-fluid box text-center">
    <div class="row">
        <div class="col-3 borderMaya">
            <div class="container-fluid top">
                {% for i in infoCampeonato%}
                <div class="container-fluid  titleTop ">
                    <i style="color:#FAC64B;" class="fas fa-trophy"></i>
<!--                    <p>NOVO CAMPEONATO</p>-->
                    <h1>{{i.1}}</h1>
                    <h6 class="alertCampeonatoType">MODALIDADE:{{i.5}}</h6>
                </div>
                {% endfor%}

                <div class="container-fluid selEquipe text-center">
                    <div class="input-group-prepend text-center">
                        <label class="input-group-text" id="labelInput" for="equipesNumber">SELECIONE O NUMERO DE EQUIPES: </label>
                    </div>
                    <select class="custom-select text-center" style="" name="equipesNumber" id="equipesNumber"
                            onchange="myTotal(this.id)">
                        <option class="text-center" selected value="0">0</option>
                        {% if bracket == 16 %}
                        <option value="48">48</option>
                        {% endif %}
                        {% if bracket == 8 %}
                        <option class="text-center" value="24">24</option>
                        <option class="text-center" value="32">32</option>
                        <option class="text-center" value="48">48</option>
                        {% endif %}
                        {% if bracket == 1 %}
                        <option class="text-center" value="16">16</option>
                        {% endif %}
                    </select>
                </div>
            </div>

        </div>
        <div class="col-9">
            <div class="container-fluid detailsBacket">
                <ul id="squadUl">
                </ul>
            </div>
             <div class="subButton2" id="submitOld">AGUARDANDO...</div>
        </div>
    </div>

</div>
<button style="display:none;" type="button" class="btn btn-primary" data-toggle="modal" id="mymodal"
        data-target="#waitModal"  data-backdrop="static" data-keyboard="false">
    Launch demo modal
</button>
<div class="modal fade" id="waitModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content" id="modalContent">
            <div class="modal-body centerT">
                <img id="image" style="opacity:0.89;" src="../static/assets/bracket.svg" height="200">
                <div class="container-fluid text-center loadBox ">
                    <h6 id="spinText">SALVANDO BRACKET...AGUARDE!</h6>
                    <div id="spin" class="spinner-grow text-danger" style="width: 3rem; height: 3rem;" role="status">
                    </div>
                </div>


            </div>
            <!--      <div class="modal-footer">-->
            <!--        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>-->
            <!--        <button type="button" class="btn btn-primary">Save changes</button>-->
            <!--      </div>-->
        </div>
    </div>
</div>


<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"
        integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
</body>


<script>


 var socket = io.connect('http://' + document.domain + ':' + location.port) ;
var submitOld = document.getElementById('submitOld')


listaSquad = [{{idCampeonato}},{{bracket}},{{regras}},'{{nomeCampeonato}}']
var contador = 0;

    function mySelect(this_id) {
    doJob(this_id);
        var totalSelect = document.getElementById('equipesNumber').value;
        if(contador < totalSelect){
            resetListNoActive();
         submitOld.classList.remove('active');
         submitOld.innerHTML = 'AGUARDANDO...'
         submitOld.style.background = 'rgba(0,0,0,.3)';
         submitOld.style.color = 'RGBA(255,255,255,.6)';
        submitOld.style.cursor = 'default';
        submitOld.setAttribute("onclick", "");

        }
        if(contador == totalSelect){
        var click = document.getElementById(this_id+'Checkbox').checked;


        submitOld.innerHTML = 'ENVIAR E CRIAR O BRACKET';
        submitOld.style.background = '#29c7ac';
        submitOld.style.color = 'rgba(0,0,0,0.8)';
        submitOld.style.cursor = 'pointer';
        submitOld.setAttribute("onclick", "submitSquad()");;

        var disableMenu = document.querySelectorAll('.noActive');
        disableMenu.forEach(function(e) {
            e.classList.remove('cursor');
            e.classList.remove('noOpacity');
            e.setAttribute("onclick", "");
             });
        }
        if(contador > totalSelect){
        }
document.getElementById('countSquads').innerHTML = contador;
 }

var submitNew = document.getElementById('submitNew')
function submitValidade(){
submitOld.style.display = 'none';
submitNew.style.display = 'block';
var disableMenu = document.querySelectorAll('.noActive');
disableMenu.forEach(function(e) {
    e.classList.remove('cursor');
        e.classList.remove('noOpacity');
        e.setAttribute("onclick", "");
    });
}




function doJob(this_id){
    var select = document.getElementById(this_id+'Checkbox').checked;
    var name=document.getElementById(this_id+'Checkbox').value
    if(select == false){
    document.getElementById(this_id+'Checkbox').checked = true;
    document.getElementById(this_id).classList.remove('noActive');
    document.getElementById(this_id).classList.add('active');
    addSquad(this_id,name);
    }
    if(select == true){
    document.getElementById(this_id+'Checkbox').checked = false;
    document.getElementById(this_id).classList.remove('active');
    document.getElementById(this_id).classList.add('noActive');
    removeSquad(this_id,name);
    }

}


function addSquad(this_id,name) {

listaSquad.push({idsquad:this_id, squad:name});
contador++

}

function removeSquad(this_id,name) {

listaSquad.pop({idsquad:this_id, squad:name});
contador--;
}




function myTotal(this_id) {
    var squadnumber = document.getElementById(this_id).value;
    if (contador > 0 ){
         if (contador < squadnumber){
         resetListNoActive();
         }
         document.getElementById("totalSquads").innerHTML = squadnumber;
    }
    if (contador == 0 ){
     if(squadnumber > 0 ){
            intList(squadnumber);
     }
    }
}

function intList(squadnumber){
var box =  document.querySelectorAll(".squadItem");
            document.getElementById("totalSquads").innerHTML = squadnumber;
            box.forEach(function(e) {
            e.classList.add('cursor');
            e.classList.add('noOpacity');
            e.setAttribute("onclick", "mySelect(this.id)");
               })
}

function resetListNoActive(){
var box =  document.querySelectorAll(".noActive");
                box.forEach(function(e) {
                e.classList.add('cursor');
                e.classList.add('noOpacity');
                e.setAttribute("onclick", "mySelect(this.id)");
                   })
         }









$( document ).ready(function() {
socket.emit('bracket setup')
});



var insertSquad = document.getElementById('squadUl');
socket.on('bracket setup response', function(data){
data.forEach(function(e) {
e.forEach(function(c) {

squad = c[1]
idsquad = c[0]


var li = document.createElement("li");
   li.setAttribute('class', 'squadItem noActive');
   li.setAttribute('id', idsquad);
   var textnode = document.createTextNode(squad);
   li.appendChild(textnode);
   var input = document.createElement("input");
   input.setAttribute('type', 'hidden');
   input.setAttribute('id', idsquad+'Checkbox');
   input.setAttribute('value', squad);
   li.appendChild(input);
   insertSquad.appendChild(li);
})
})
})




function submitSquad(){
document.getElementById('mymodal').click();
socket.emit('submit bracket', listaSquad);
}



socket.on('salved', function(data){
console.log(data);

document.getElementById('image').src = '../static/assets/check.svg';
document.getElementById('spin').style.display = 'none';
document.getElementById('spinText').innerHTML = 'TUDO OK! '+ data[0].toUpperCase()+' ADICIONADO !';
 setTimeout(function () {
       window.location.href = "/dashboard"; //will redirect to your blog page (an ex: blog.html)
    }, 2000); //will call the function after 2 secs.



})


</script>
</html>


